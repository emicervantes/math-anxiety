---
title: "Math/COVID Anxiety Row Data EDA"
author: "Emi"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
library(tidyverse)
```

# Loading Row Data

```{r}
mathCOVID <- readxl::read_excel('../data/KidsCOVID_Winter21_raw data.xlsx')
```

# Dataset Summary

The dataset was a study which investigated whether worked examples could be used to reduce cognitive loads on mathematics learners. They measured potential predictors of reduce in memory load such as mathematical anxiety and COVID learning anxiety. The results showed that mathematical anxiety was a significant negative factor in students' procedural and conceptual learning.

Students were tested on their mathematical knowledge before the study (pretest), during the two0day study (during the lesson - Day 1), and after the study (three days later - Day 2)

## Emotions Scores

-   Pre Study Assessment: `Base_Enjoy`, `Base_Worry`

-   During Study Assessment: `During_OverallAcc`, `During_HOT`, `DurImm_OverallAcc`, `DuringImm_HOT`

-   Post Study Assessment: `Del_OverallAcc`, `Del_acc`, `Del_HOT`

-   Other important measurements: `Understand_avg`, `PaidAttn_avg`, `SI_avg`

# Cleaning Data

Retreat duplicate students' data

```{r}
df_nd <- mathCOVID %>% 
          mutate(drop = replace_na(drop, 0)) %>% 
          filter(drop != 1) %>% 
          mutate("id"= row_number(), .before = drop )
head(df_nd)
```

Delete unnecessary columns:

```{r}
df_nd %>% 
  select(starts_with("Base"))
df_nd %>% 
  select(starts_with("Dur"))
df_nd %>% 
  select(starts_with("understand"))
df_nd %>% 
  select(starts_with("Paid"))
df_nd %>% 
  select(starts_with("SI"))
df_nd %>% 
  select(starts_with("Del"))
```

```{r}
df <- df_nd %>% 
    select("id", "Base_Enjoy", "Base_Worry", 
            "During_OverallAcc", "During_HOT", "DurImm_OverallAcc", "DurImm_HOT",
            "Del_OverallAcc", "Del_acc", "Del_HOT",
           "Understand_avg", "PaidAttn_avg", 
           "SI_1","SI_2","SI_3","SI_4","SI_5","SI_6","SI_7","SI_8","SI_9","SI_10",
           "SI_avg")
head(df)
```

# Data Visualization

## Pre-Test Visualizations

```{r}
pre_enjoy <- df %>% 
               group_by("Score" = Base_Enjoy) %>% 
               summarize(Freq=n()) %>% 
               mutate("Status" = "Enjoy", .before = Score) %>% 
               na.omit()
pre_worry <- df %>% 
               group_by("Score" = Base_Worry) %>% 
               summarize(Freq=n()) %>% 
               mutate("Status" = "Worry", .before = Score)
rbind(pre_enjoy, pre_worry) %>% 
  ggplot(aes(x = Score, y = Freq, fill = Status)) + 
  geom_col(position = "dodge", color = "black") + 
  theme_minimal() + scale_fill_brewer(palette="Pastel1") +
  labs(title = "Pre-Score Distribution Enjoy and Worry", x = "Score", y = "Count")

```

## During-test Visualization

```{r}
# Overall accuracy vs HOT scores with pre-worry scores
df %>% 
  select("id", starts_with("Base"), starts_with("Dur") ) %>% 
  ggplot(aes(x = During_OverallAcc, y = During_HOT, color = Base_Worry)) + 
  geom_point(size = 2) + scale_colour_gradient(low = "deepskyblue2", high = "darkblue", na.value = NA) +
  labs(title = "During Assessment: Overall Accuracy vs HOT Score", x = "Overall Accuracy", y = "HOT", color = "Pre-Worry Score") +
  theme_minimal()

# Overall accuracy vs HOT scores with pre-enjoy scores
df %>% 
  select("id", starts_with("Base"), starts_with("Dur") ) %>% 
  ggplot(aes(x = During_OverallAcc, y = During_HOT, color = Base_Enjoy)) + 
  geom_point(size = 2) + scale_colour_gradient(low = "yellow", high = "red", na.value = NA)+
  labs(title = "During Assessment: Overall Accuracy vs HOT Score", x = "Overall Accuracy", y = "HOT", color = "Pre-Enjoy Score") +
  theme_minimal()

# Combining enjoy and worry scores
df %>% 
  select("id", starts_with("Base"), starts_with("Dur") ) %>% 
  mutate("pre_emotion" = Base_Enjoy - Base_Worry) %>% 
  ggplot(aes(x = During_OverallAcc, y = During_HOT, color = pre_emotion)) + 
  geom_point(size = 2) + scale_colour_gradient(low = "deepskyblue2", high = "coral1", na.value = NA)+
  labs(title = "During Assessment: Overall Accuracy vs HOT Score", x = "Overall Accuracy", y = "HOT", color = "Pre-Emotion Score") +
  theme_minimal()
```

During and During Immediate Scores

```{r}
dur <- select(df, pre_enjoy = "Base_Enjoy", pre_worry = "Base_Worry" ,acc = "During_OverallAcc", HOT = "During_HOT") %>%  mutate(status = "dur")
durImm <- select(df,  pre_enjoy = "Base_Enjoy", pre_worry = "Base_Worry", acc = "DurImm_OverallAcc", HOT = "DurImm_HOT") %>% 
  mutate(status = "durImm")

rbind(dur, durImm) %>% 
  mutate(pre_score = pre_enjoy - pre_worry) %>% 
  ggplot(aes(x = acc, y = HOT, color = status)) +
  geom_point() + 
  scale_color_manual(labels=c('During', 'During Imm'), values = c("darkgreen", "orange")) +
  theme_minimal() +
  labs(title = "During vs During Immediate Accuracy and HOT Scores", color = "Status",
       x = "Overall Accuracy", y = "HOT")

rbind(dur, durImm) %>% 
  filter(status == "durImm") %>% 
  mutate(pre_score = pre_enjoy - pre_worry) %>% 
  ggplot(aes(x = acc, y = HOT, color = pre_enjoy)) +
  geom_point() + scale_colour_gradient(low = "yellow", high = "red", na.value = NA) +
  theme_minimal() +
  labs(title = "During Immediate Overall Accuracy vs HOT Scores", x = "Overall Accuracy",
       y = "HOT", color = "Pre-Enjoy") 

rbind(dur, durImm) %>% 
  filter(status == "durImm") %>% 
  mutate(pre_score = pre_enjoy - pre_worry) %>% 
  ggplot(aes(x = acc, y = HOT, color = pre_worry)) +
  geom_point() + scale_colour_gradient(low = "deepskyblue2", high = "darkblue", na.value = NA) +
  theme_minimal() +
  labs(title = "During Immediate Overall Accuracy vs HOT Scores", x = "Overall Accuracy",
       y = "HOT", color = "Pre-Worry") 

rbind(dur, durImm) %>% 
  filter(status == "durImm") %>% 
  mutate(pre_score = pre_enjoy - pre_worry) %>% 
  ggplot(aes(x = acc, y = HOT, color = pre_score)) +
  geom_point() + scale_colour_gradient(low = "deepskyblue2", high = "coral1", na.value = NA)+
  theme_minimal() +
  labs(title = "During Immediate Overall Accuracy vs HOT Scores", x = "Overall Accuracy",
       y = "HOT", color = "Pre-Emotion") 
```

## Delayed Visualization

```{r}
df %>% 
  select(pre_enjoy = "Base_Enjoy", pre_worry = "Base_Worry", acc = "Del_acc", HOT = "Del_HOT") %>% mutate(pre_score = pre_enjoy - pre_worry) %>% 
  ggplot(aes(x = acc, y = HOT, color = pre_score)) + geom_point() +
  scale_colour_gradient(low = "deepskyblue2", high = "coral1", na.value = NA) +
  theme_minimal() +
  labs(title = "Delayed Accuracy vs HOT", x = "Overall Accuracy", y = "HOT", color = "Pre-Emotion") 
```

Comparing Dur, DurImm, Del Accuracy Scores
 
```{r}
duracc <- df %>%  
  select(pre_enjoy = "Base_Enjoy", pre_worry = "Base_Worry",
                          acc = "During_OverallAcc") %>% mutate(status = "During")
durIacc <- df %>%  
  select(pre_enjoy = "Base_Enjoy", pre_worry = "Base_Worry",
                          acc = "DurImm_OverallAcc") %>% mutate(status = "Immediate")
delacc <- df %>%  
  select(pre_enjoy = "Base_Enjoy", pre_worry = "Base_Worry",
                          acc = "Del_acc") %>% mutate(status = "Delayed")
rbind(duracc, durIacc, delacc) %>%  mutate(pre_score = pre_enjoy - pre_worry) %>% 
  ggplot(aes(x = acc)) + geom_histogram(bins=10, color = "black") + facet_grid(.~status, scales = "free", ) +
    scale_color_brewer(palette = "Set1") +theme_minimal() + 
  labs(title = "Accuracy Distributions at Different Times of Study", 
                         x = "Overall Accuracy Score", y = "Count") 
```

